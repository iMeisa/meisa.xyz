{{template "base" .}}

{{define "title"}}F1 Setup Helper{{end}}

{{define "content"}}
    <div class="container">

        <h1 class="mb-4">F1 Setup Helper</h1>

        <div class="btn-group mt-4 mb-4" role="group" aria-label="part-sections">
            <button class="btn btn-primary" type="button" onclick="showTableGroup('aero')">Aerodynamics</button>
            <button class="btn btn-primary" type="button" onclick="showTableGroup('transmission')">Transmission</button>
            <button class="btn btn-primary" type="button" onclick="showTableGroup('suspension-geo')">Suspension Geometry</button>
            <button class="btn btn-primary" type="button" onclick="showTableGroup('suspension')">Suspension</button>
            <button class="btn btn-primary" type="button" onclick="showTableGroup('brakes')">Brakes</button>
            <button class="btn btn-primary" type="button" onclick="showTableGroup('tires')">Tires</button>
        </div>

        <div id="parts-tables"></div>
    </div>
{{end}}


{{define "css"}}
    <style>
        /* Tables */
        .part-name {
            width: 33%
        }
        .part-desc {
            width: 33%
        }


        /* Progress Bars */
        .increase-setup {
            background-color: lawngreen;
        }

        .decrease-setup {
            background-color: red;
        }

    </style>
{{end}}


{{define "js"}}

    <script>
        activateNav('nav-f1setup')

        let parts = JSON.parse({{index .StringMap "parts_list"}})

        buildTables()

        function buildTables(){
            let parts_tables = document.getElementById('parts-tables')
            for (const group_name in parts) {
                parts_tables.innerHTML += `
                    <table class="table table-dark table-${group_name} mt-4 mb-4" id="table-${group_name}">
                        <tbody id="${group_name}-parts">
                        </tbody>
                    </table>
                `

                let group_parts = document.getElementById(`${group_name}-parts`)
                for (const part_name in parts[group_name]) {
                    const part = parts[group_name][part_name]

                    const progress_bar_width = (part['default'] - part['min-value']) / (part['max-value'] - part['min-value']) * 100
                    console.log(part_name, progress_bar_width)

                    group_parts.innerHTML += `
                        <tr id="${part_name}">
                            <td class="part-name">${part['name']}</td>
                            <td class="part-setup">
                                <div class="progress">
                                    <div class="progress-bar" style="width: ${progress_bar_width}%"></div>
                                    <div class="progress-bar increase-setup" style="width: 0"></div>
                                    <div class="progress-bar decrease-setup" style="width: 0"></div>
                                </div>
                                <span> ${part['default']} </span>
                            </td>
                            <td class="part-desc">${part['min-name']} ${part['min-value']} - ${part['max-value']} ${part['max-name']}</td>
                        </tr>
                    `
                }
            }

        }

        function showTableGroup(table_name) {
            for (const group_name in parts) {
                const table_group = document.getElementById(`table-${group_name}`)
                if (table_group.hasAttribute('hidden')) { continue }
                table_group.setAttribute('hidden', '')
            }
            document.getElementById(`table-${table_name}`).removeAttribute('hidden')
        }

    </script>

{{end}}