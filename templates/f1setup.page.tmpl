{{template "base" .}}

{{define "title"}}F1 Setup Helper{{end}}

{{define "content"}}
    <div class="container">

        <h1 class="mb-4">F1 Setup Helper</h1>

        <div class="btn-group mt-4 mb-4" role="group" aria-label="part-sections">
            <button class="btn btn-primary" type="button" onclick="showTableGroup('aero')">Aerodynamics</button>
            <button class="btn btn-primary" type="button" onclick="showTableGroup('transmission')">Transmission</button>
            <button class="btn btn-primary" type="button" onclick="showTableGroup('suspension-geo')">Suspension Geometry</button>
            <button class="btn btn-primary" type="button" onclick="showTableGroup('suspension')">Suspension</button>
            <button class="btn btn-primary" type="button" onclick="showTableGroup('brakes')">Brakes</button>
            <button class="btn btn-primary" type="button" onclick="showTableGroup('tires')">Tires</button>
        </div>

        <div id="parts-tables"></div>
    </div>
{{end}}


{{define "css"}}
    <style>
        /* Tables */
        .part-name {
            width: 33%
        }
        .part-desc {
            width: 33%
        }


        /* Progress Bars */
        .increase-setup {
            background-color: lawngreen;
        }

        .decrease-setup {
            background-color: red;
        }

    </style>
{{end}}


{{define "js"}}

    <script>
        activateNav('nav-f1setup')

        let parts = JSON.parse({{index .StringMap "parts_list"}})

        let setup = {}

        for (const group_name in parts) {
            for (const part_name in parts[group_name]) {
                setup[part_name] = parts[group_name][part_name]['default']
            }
        }

        buildTables()

        function buildTables(){
            let parts_tables = document.getElementById('parts-tables')
            for (const group_name in parts) {
                parts_tables.innerHTML += `
                    <table class="table table-dark table-${group_name} mt-4 mb-4" id="table-${group_name}">
                        <tbody id="${group_name}-parts">
                        </tbody>
                    </table>
                `

                let group_parts = document.getElementById(`${group_name}-parts`)
                for (const part_name in parts[group_name]) {
                    const part = parts[group_name][part_name]

                    group_parts.innerHTML += `
                        <tr id="${part_name}">
                            <td class="part-name">${part['name']}</td>
                            <td class="part-setup">
                                <div class="progress">
                                    <div class="progress-bar" id="${part_name}-bar" style="width: 0"></div>
                                    <div class="progress-bar increase-setup" id="${part_name}-bar-increase" style="width: 0"></div>
                                    <div class="progress-bar decrease-setup" id="${part_name}-bar-decrease" style="width: 0"></div>
                                </div>
                                <button class="btn btn-danger mt-2 me-4" onclick="changePartValue('${group_name}', '${part_name}', -${part['step']})"><</button>
                                <span id="${part_name}-value" style="padding-top: 5em">${part['default']}</span>
                                <button class="btn btn-success mt-2 ms-4" onclick="changePartValue('${group_name}', '${part_name}', ${part['step']})">></button>
                            </td>
                            <td class="part-desc">${part['min-name']} ${part['min-value']} - ${part['max-value']} ${part['max-name']}</td>
                        </tr>
                    `
                }
            }
            updateProgressBars()
        }

        function changePartValue(group_name, part_name, step) {
            const part = parts[group_name][part_name]
            let part_setup = document.getElementById(`${part_name}-value`)
            const setup_value = parseFloat(part_setup.innerHTML)
            if (part['min-value'] <= (setup_value + step) && (setup_value + step) <= part['max-value']) {
                part_setup.innerHTML = `${((setup_value * 100) + (step * 100)) / 100}`
            }
            updateProgressBars()
        }

        function updateProgressBars() {
            for (const group_name in parts) {
                for (const part_name in parts[group_name]) {
                    let part_bar = document.getElementById(`${part_name}-bar`)
                    const part_setup = Number(document.getElementById(`${part_name}-value`).innerHTML)
                    const part = parts[group_name][part_name]
                    part_bar.style.width = `${(part_setup - part['min-value']) / (part['max-value'] - part['min-value']) * 100}%`
                }
            }
        }

        function showTableGroup(table_name) {
            for (const group_name in parts) {
                const table_group = document.getElementById(`table-${group_name}`)
                if (table_group.hasAttribute('hidden')) { continue }
                table_group.setAttribute('hidden', '')
            }
            document.getElementById(`table-${table_name}`).removeAttribute('hidden')
        }

    </script>

{{end}}